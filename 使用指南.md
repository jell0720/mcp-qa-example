# Langflow 文檔問答系統 MCP 工具使用指南

## 概述

這個 MCP 工具允許您直接在 Claude 中查詢 Langflow 文檔問答系統，無需離開對話界面。它通過 Model Context Protocol (MCP) 實現了與 Langflow 的無縫集成。

## 安裝前準備

在開始之前，請確保：

1. 您已安裝 Python 3.8+ 和 uv 套件管理器
2. 您已啟動 Langflow 服務，並在 `.env` 文件中設置正確的 API URL 和 Flow ID
3. 您已安裝 Claude Desktop 應用程序 (如需使用 Claude 集成功能)

## 設置步驟

### 1. 克隆或下載代碼庫

確保您已獲得所有必要的代碼文件。

### 2. 使用 uv 創建虛擬環境並安裝依賴

```bash
# 創建虛擬環境
uv venv .venv

# 激活虛擬環境
source .venv/bin/activate

# 安裝 MCP 和其他依賴
uv add "mcp[cli]" requests python-dotenv typer uvicorn

# 安裝此包
pip install -e .
```

### 3. 配置環境變數

編輯 `.env` 文件，設置以下參數：

```
# Langflow API 設定
LANGFLOW_API_URL=http://127.0.0.1:7864  # 根據您的 Langflow 服務地址調整
LANGFLOW_FLOW_ID=your-flow-id-here  # 您的 Langflow flow ID
LANGFLOW_ENDPOINT=  # 可選的端點名稱
LANGFLOW_API_KEY=  # 如果需要 API 密鑰

# 服務器設定
PORT=8000  # MCP 服務器運行的端口
```

## 使用方法

### 開發模式

在開發模式下運行 MCP 工具，方便測試和調整：

```bash
langflow-mcp dev
```

這將在本地啟動一個 MCP 服務器，並使用 MCP Inspector 進行交互，便於開發和調試。

### 安裝到 Claude Desktop

一旦您的工具運行正常，您可以將其安裝到 Claude Desktop 應用中：

```bash
langflow-mcp install --name "Langflow 文檔問答"
```

這將在 Claude Desktop 中註冊您的工具，使其可在 Claude 會話中使用。

### 直接運行服務器

如果您需要對服務器進行更多控制，可以直接運行它：

```bash
langflow-mcp run
```

## 功能說明

### 1. 查詢功能 (Tool)

在 Claude 中，您可以使用 `langflow_query` 工具向 Langflow 發送查詢：

```
使用 langflow_query 工具來查詢 "什麼是向量資料庫"
```

參數:
- `query`: 要檢索的查詢或問題
- `tweaks`: (可選) 用於自定義 flow 的參數

### 2. 狀態查詢 (Resource)

您可以引用 `langflow://status` 資源來查看 Langflow 服務的狀態：

```
請檢查 langflow://status 資源，確認服務是否在線
```

這將返回一個包含服務狀態信息的對象。

### 3. 查詢模板 (Prompt)

提供了一個名為 `langflow_query_template` 的提示模板，幫助您格式化查詢：

```
使用 langflow_query_template 提示，我想查詢 "如何使用 LangChain"
```

## 故障排除

如果您遇到以下問題：

1. **連接失敗**: 確保 Langflow 服務正在運行，並檢查 `.env` 中的 URL 是否正確
2. **認證錯誤**: 如果 Langflow 需要 API 密鑰，請在 `.env` 文件中提供
3. **查詢返回錯誤**: 檢查 Flow ID 是否正確，以及 flow 是否正確配置

## 進階設置

### 自定義 Tweaks

您可以在 `server.py` 中修改 `DEFAULT_TWEAKS` 字典來自定義 Langflow 的行為：

```python
DEFAULT_TWEAKS = {
  "YourComponent-ID": {"parameter": "value"},
  # ...其他組件
}
```

### 部署到生產環境

對於生產部署，請考慮：

1. 使用 HTTPS 保護通信
2. 設置適當的訪問控制
3. 配置日誌記錄
4. 考慮使用容器化部署

## 後續開發

這個工具可以進一步擴展：

1. 添加文件上傳功能
2. 實現歷史查詢記錄
3. 添加更多 Langflow 的 API 功能
4. 改進錯誤處理和反饋機制

## 支持資源

如需更多幫助：

- MCP 文檔: [Model Context Protocol 文檔](https://github.com/modelcontextprotocol/python-sdk)
- Langflow 文檔: [Langflow 官方文檔](https://docs.langflow.org)

---

祝您使用愉快！如有任何問題或建議，請隨時提出。 